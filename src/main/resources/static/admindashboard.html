<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Admin Dashboard - MotorCare LK</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 0; background: #f8f9fa;
        }
        .admin-layout {
            display: flex;
            min-height: 100vh;
        }
        .admin-sidebar {
            width: 280px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 1.5rem 1rem;
        }
        .sidebar-header {
            margin-bottom: 2rem;
            text-align: center;
        }
        .sidebar-header h3 {
            color: #ff6b35;
            margin-bottom: 0.5rem;
        }
        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .sidebar-item {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            padding: 0.75rem 1rem;
            text-align: left;
            font-size: 1rem;
            border-left: 4px solid transparent;
            transition: background 0.3s, border-left 0.3s;
        }
        .sidebar-item:hover,
        .sidebar-item.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left: 4px solid #ff6b35;
        }
        .admin-content {
            flex: 1;
            padding: 2rem;
            background: #fff;
        }
        h2 {
            color: #4a69bd;
            margin-bottom: 1rem;
        }
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }
        .alert.show {
            display: block;
        }
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #f8f9fa;
            color: #4a69bd;
        }
        tr:hover {
            background: #f0f4ff;
        }
    </style>
</head>
<body>
<div class="admin-layout">
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <h3>üõ°Ô∏è Admin Panel</h3>
            <p>Management System</p>
        </div>
        <nav class="sidebar-nav">
            <button class="sidebar-item active" onclick="showSection('overview', event)">Dashboard Overview</button>
            <button class="sidebar-item" onclick="showSection('users', event)"> User Management</button>
            <button class="sidebar-item" onclick="navigateTo('adminpolicy.html')"> Policy Management</button>
            <button class="sidebar-item" onclick="navigateTo('adminclaims.html')"> Claims Management</button>
            <button class="sidebar-item" onclick="navigateTo('adminpayment.html')"> Payment Management</button>
            <button class="sidebar-item" onclick="navigateTo('notificationadmin.html')"> Notifications</button>
            <button class="sidebar-item" onclick="navigateTo('adminreport.html')"> Reports & Analytics</button>
        </nav>
    </aside>
    <main class="admin-content">
        <div id="adminDashboardAlert" class="alert"></div>

        <section id="overview" class="admin-section" style="display:block;">
            <h2> Dashboard Overview</h2>
            <!-- Example summary cards -->
            <div>
                <strong>Total Users:</strong> <span id="totalUsersCount">Loading...</span>
            </div>
            <div style="margin-top: 1rem;">
                <button onclick="refreshDashboard()">Refresh Data</button>
            </div>
        </section>

        <section id="users" class="admin-section" style="display:none;">
            <h2> User Management</h2>
            <div id="usersTable">Loading users...</div>
        </section>
    </main>
</div>
<script>
    const API_BASE_URL = 'http://localhost:8080/api';

    function navigateTo(page) {
        window.location.href = page;
    }

    function showAlert(message, type) {
        const alertDiv = document.getElementById('adminDashboardAlert');
        alertDiv.textContent = message;
        alertDiv.className = `alert alert-${type} show`;
        setTimeout(() => alertDiv.classList.remove('show'), 5000);
    }

    function showSection(sectionId, event) {
        document.querySelectorAll('.admin-section').forEach(s => s.style.display = 'none');
        document.getElementById(sectionId).style.display = 'block';

        document.querySelectorAll('.sidebar-item').forEach(btn => btn.classList.remove('active'));
        if(event) event.target.classList.add('active');
    }

    async function apiCall(endpoint, method='GET', data=null) {
        const options = { method, headers:{'Content-Type':'application/json'} };
        if(data) options.body = JSON.stringify(data);

        try {
            const response = await fetch(API_BASE_URL + endpoint, options);
            return await response.json();
        } catch(err) {
            showAlert('Error connecting to server.', 'error');
            return null;
        }
    }

    async function refreshDashboard() {
        showAlert('Loading dashboard data...', 'success');
        const data = await apiCall('/admin/dashboard');
        if(data && data.success) {
            document.getElementById('totalUsersCount').textContent = data.totalUsers || 0;
            populateUsersTable(data.users || []);
            showAlert('Dashboard data refreshed.', 'success');
        } else {
            showAlert('Failed to load dashboard data.', 'error');
            document.getElementById('totalUsersCount').textContent = '0';
            populateUsersTable([]);
        }
    }

    function populateUsersTable(users) {
        const container = document.getElementById('usersTable');
        if(!users.length) {
            container.innerHTML = '<p>No users available.</p>';
            return;
        }
        let html = '<table><thead><tr><th>ID</th><th>Name</th><th>Email</th><th>NIC</th><th>Phone</th><th>Age</th><th>Actions</th></tr></thead><tbody>';
        users.forEach(user => {
            html += `<tr>
        <td>${user.id}</td>
        <td>${user.name}</td>
        <td>${user.email}</td>
        <td>${user.nic}</td>
        <td>${user.telephone}</td>
        <td>${user.age}</td>
        <td><button onclick="deleteUser(${user.id})">üóëÔ∏è Delete</button></td>
      </tr>`;
        });
        html += '</tbody></table>';
        container.innerHTML = html;
    }

    async function deleteUser(id) {
        if(!confirm('Delete this user? This cannot be undone.')) return;
        const res = await apiCall(`/admin/users/${id}`, 'DELETE');
        if(res && res.success) {
            showAlert(res.message, 'success');
            refreshDashboard();
        } else {
            showAlert(res.message || 'Failed to delete user.', 'error');
        }
    }

    // Initial load
    window.onload = refreshDashboard;
</script>
</body>
</html>
